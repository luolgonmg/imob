{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{makeStyles}from\"@material-ui/core/styles\";import Paper from\"@material-ui/core/Paper\";import{toast}from\"react-toastify\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import Title from\"../../components/Title\";import DeleteOutlineIcon from\"@material-ui/icons/DeleteOutline\";import api from\"../../services/api\";import{i18n}from\"../../translate/i18n\";import{Box,Button,FormControl,Grid,IconButton,InputLabel,MenuItem,Select,Table,TableBody,TableCell,TableHead,TableRow,TextField,Typography}from\"@material-ui/core\";import ConfirmationModal from\"../../components/ConfirmationModal\";const useStyles=makeStyles(theme=>({mainPaper:{flex:1,padding:theme.spacing(1),overflowY:\"scroll\",...theme.scrollbarStyles},textRight:{textAlign:\"right\"},tabPanelsContainer:{padding:theme.spacing(2)}}));const initialSettings={messageInterval:20,longerIntervalAfter:20,greaterInterval:60,variables:[]};const CampaignsConfig=()=>{const classes=useStyles();const[settings,setSettings]=useState(initialSettings);const[showVariablesForm,setShowVariablesForm]=useState(false);const[confirmationOpen,setConfirmationOpen]=useState(false);const[selectedKey,setSelectedKey]=useState(null);const[variable,setVariable]=useState({key:\"\",value:\"\"});useEffect(()=>{api.get(\"/campaign-settings\").then(_ref=>{let{data}=_ref;const settingsList=[];if(Array.isArray(data)&&data.length>0){data.forEach(item=>{settingsList.push([item.key,JSON.parse(item.value)]);});setSettings(Object.fromEntries(settingsList));}});},[]);const handleOnChangeVariable=e=>{if(e.target.value!==null){const changedProp={};changedProp[e.target.name]=e.target.value;setVariable(prev=>({...prev,...changedProp}));}};const handleOnChangeSettings=e=>{const changedProp={};changedProp[e.target.name]=e.target.value;setSettings(prev=>({...prev,...changedProp}));};const addVariable=()=>{setSettings(prev=>{const variablesExists=settings.variables.filter(v=>v.key===variable.key);const variables=prev.variables;if(variablesExists.length===0){variables.push(Object.assign({},variable));setVariable({key:\"\",value:\"\"});}return{...prev,variables};});};const removeVariable=()=>{const newList=settings.variables.filter(v=>v.key!==selectedKey);setSettings(prev=>({...prev,variables:newList}));setSelectedKey(null);};const saveSettings=async()=>{await api.post(\"/campaign-settings\",{settings});toast.success(\"Configurações salvas\");};return/*#__PURE__*/React.createElement(MainContainer,null,/*#__PURE__*/React.createElement(ConfirmationModal,{title:i18n.t(\"campaigns.confirmationModal.deleteTitle\"),open:confirmationOpen,onClose:()=>setConfirmationOpen(false),onConfirm:removeVariable},i18n.t(\"campaigns.confirmationModal.deleteMessage\")),/*#__PURE__*/React.createElement(MainHeader,null,/*#__PURE__*/React.createElement(Grid,{style:{width:\"99.6%\"},container:true},/*#__PURE__*/React.createElement(Grid,{xs:12,item:true},/*#__PURE__*/React.createElement(Title,null,i18n.t(\"campaignsConfig.title\"))))),/*#__PURE__*/React.createElement(Paper,{className:classes.mainPaper,variant:\"outlined\"},/*#__PURE__*/React.createElement(Box,{className:classes.tabPanelsContainer},/*#__PURE__*/React.createElement(Grid,{spacing:2,container:true},/*#__PURE__*/React.createElement(Grid,{xs:12,item:true},/*#__PURE__*/React.createElement(Typography,{component:\"h3\"},\"Intervalos\")),/*#__PURE__*/React.createElement(Grid,{xs:12,md:4,item:true},/*#__PURE__*/React.createElement(FormControl,{variant:\"outlined\",className:classes.formControl,fullWidth:true},/*#__PURE__*/React.createElement(InputLabel,{id:\"messageInterval-label\"},\"Intervalo Rand\\xF4mico de Disparo\"),/*#__PURE__*/React.createElement(Select,{name:\"messageInterval\",id:\"messageInterval\",labelId:\"messageInterval-label\",label:\"Intervalo Rand\\xF4mico de Disparo\",value:settings.messageInterval,onChange:e=>handleOnChangeSettings(e)},/*#__PURE__*/React.createElement(MenuItem,{value:0},\"Sem Intervalo\"),/*#__PURE__*/React.createElement(MenuItem,{value:5},\"5 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:10},\"10 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:15},\"15 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:20},\"20 segundos\")))),/*#__PURE__*/React.createElement(Grid,{xs:12,md:4,item:true},/*#__PURE__*/React.createElement(FormControl,{variant:\"outlined\",className:classes.formControl,fullWidth:true},/*#__PURE__*/React.createElement(InputLabel,{id:\"longerIntervalAfter-label\"},\"Intervalo Maior Ap\\xF3s\"),/*#__PURE__*/React.createElement(Select,{name:\"longerIntervalAfter\",id:\"longerIntervalAfter\",labelId:\"longerIntervalAfter-label\",label:\"Intervalo Maior Ap\\xF3s\",value:settings.longerIntervalAfter,onChange:e=>handleOnChangeSettings(e)},/*#__PURE__*/React.createElement(MenuItem,{value:0},\"N\\xE3o definido\"),/*#__PURE__*/React.createElement(MenuItem,{value:1},\"1 segundo\"),/*#__PURE__*/React.createElement(MenuItem,{value:5},\"5 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:10},\"10 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:15},\"15 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:20},\"20 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:30},\"30 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:40},\"40 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:60},\"60 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:80},\"80 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:100},\"100 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:120},\"120 segundos\")))),/*#__PURE__*/React.createElement(Grid,{xs:12,md:4,item:true},/*#__PURE__*/React.createElement(FormControl,{variant:\"outlined\",className:classes.formControl,fullWidth:true},/*#__PURE__*/React.createElement(InputLabel,{id:\"greaterInterval-label\"},\"Intervalo de Disparo Maior\"),/*#__PURE__*/React.createElement(Select,{name:\"greaterInterval\",id:\"greaterInterval\",labelId:\"greaterInterval-label\",label:\"Intervalo de Disparo Maior\",value:settings.greaterInterval,onChange:e=>handleOnChangeSettings(e)},/*#__PURE__*/React.createElement(MenuItem,{value:0},\"Sem Intervalo\"),/*#__PURE__*/React.createElement(MenuItem,{value:1},\"1 segundo\"),/*#__PURE__*/React.createElement(MenuItem,{value:5},\"5 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:10},\"10 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:15},\"15 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:20},\"20 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:30},\"30 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:40},\"40 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:60},\"60 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:80},\"80 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:100},\"100 segundos\"),/*#__PURE__*/React.createElement(MenuItem,{value:120},\"120 segundos\")))),/*#__PURE__*/React.createElement(Grid,{xs:12,className:classes.textRight,item:true},/*#__PURE__*/React.createElement(Button,{onClick:()=>setShowVariablesForm(!showVariablesForm),color:\"primary\",style:{marginRight:10}},\"Adicionar Vari\\xE1vel\"),/*#__PURE__*/React.createElement(Button,{onClick:saveSettings,color:\"primary\",variant:\"contained\"},\"Salvar Configura\\xE7\\xF5es\")),showVariablesForm&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Grid,{xs:12,md:6,item:true},/*#__PURE__*/React.createElement(TextField,{label:\"Atalho\",variant:\"outlined\",value:variable.key,name:\"key\",onChange:handleOnChangeVariable,fullWidth:true})),/*#__PURE__*/React.createElement(Grid,{xs:12,md:6,item:true},/*#__PURE__*/React.createElement(TextField,{label:\"Conte\\xFAdo\",variant:\"outlined\",value:variable.value,name:\"value\",onChange:handleOnChangeVariable,fullWidth:true})),/*#__PURE__*/React.createElement(Grid,{xs:12,className:classes.textRight,item:true},/*#__PURE__*/React.createElement(Button,{onClick:()=>setShowVariablesForm(!showVariablesForm),color:\"primary\",style:{marginRight:10}},\"Fechar\"),/*#__PURE__*/React.createElement(Button,{onClick:addVariable,color:\"primary\",variant:\"contained\"},\"Adicionar\"))),settings.variables.length>0&&/*#__PURE__*/React.createElement(Grid,{xs:12,className:classes.textRight,item:true},/*#__PURE__*/React.createElement(Table,{size:\"small\"},/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{style:{width:\"1%\"}}),/*#__PURE__*/React.createElement(TableCell,null,\"Atalho\"),/*#__PURE__*/React.createElement(TableCell,null,\"Conte\\xFAdo\"))),/*#__PURE__*/React.createElement(TableBody,null,Array.isArray(settings.variables)&&settings.variables.map((v,k)=>/*#__PURE__*/React.createElement(TableRow,{key:k},/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(IconButton,{size:\"small\",onClick:()=>{setSelectedKey(v.key);setConfirmationOpen(true);}},/*#__PURE__*/React.createElement(DeleteOutlineIcon,null))),/*#__PURE__*/React.createElement(TableCell,null,\"{\"+v.key+\"}\"),/*#__PURE__*/React.createElement(TableCell,null,v.value))))))))));};export default CampaignsConfig;","map":null,"metadata":{},"sourceType":"module"}